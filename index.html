<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Happy Coin: Crypto War (Fixed)</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>Happy Coin: Crypto War</h1>
  <div class="top-stats">
    <div class="chip">رمز ارز: <strong id="coins">0</strong> 🪙</div>
    <div class="chip">دیتاسنتر: <strong id="dcCount">0</strong></div>
    <div class="chip">قیمت بعدی DC: <strong id="dcCost">50</strong> 🪙</div>
  </div>
</header>

<main>
  <section class="card">
    <div class="battle-area">
      <div class="arena" id="arenaContainer" aria-live="polite" style="position:relative">
        <div class="boss-warning" id="bossWarning">!حمله ویژه در راه است — جاخالی بده</div>
        <div class="arena-top" style="width:100%;display:flex;justify-content:space-between">
          <div class="hp">باس: <span id="bossHPText">HP: 300</span></div>
          <div class="hp">تو: <span id="playerHPText">HP: 100</span></div>
        </div>
        <canvas id="arenaCanvas" width="720" height="360" style="max-width:100%; width:100%; height:auto;"></canvas>

        <div class="hud">
          <div class="controls" style="align-items:flex-end">
            <div style="display:flex;flex-direction:column;gap:6px">
              <button class="btn" id="attackBtn">حمله (Space)</button>
              <div class="attack-cooldown" title="کول‌داون حمله"><i id="attackCooldownFill" style="width:0%"></i></div>
            </div>
            <div style="display:flex;flex-direction:column;gap:6px">
              <button class="btn secondary" id="actBtn">Act</button>
              <button class="btn secondary" id="buyDCBtn">خرید دیتاسنتر</button>
            </div>
            <button class="btn ghost" id="retreatBtn" style="display:none">فرار</button>
          </div>
          <div id="itemBar"></div>
          <div class="status"><span id="statusText">آماده</span> — مرحله: <strong id="currentStageText">—</strong></div>
        </div>

        <div id="timingUI" class="timing-ui" style="display:none" aria-hidden="true">
          <div id="sweetZone" class="timing-bar-sweet"></div>
          <div id="pointer" class="timing-bar-pointer" style="left:0px"></div>
        </div>
      </div>

      <div style="flex:1; max-width:360px;">
        <div class="card" style="margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>جزئیات باس: <span id="bossName" class="small" style="font-weight:800;color:var(--accent)">—</span></div>
            <div class="small">فاز: <span id="bossPhaseText">1</span></div>
          </div>
          <div class="hp-bar" style="margin-top:8px"><div id="bossHPFill" class="fill" style="width:100%"></div></div>
          <div style="height:8px"></div>
          <div class="log" id="log">&gt; خوش آمدی! با جوی‌استیک جاخالی بده و با Space حمله کن.</div>
        </div>

        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
            <div>کنترل‌ها</div>
            <div class="small">حرکت: فلش‌ها یا جوی‌استیک / حمله: Space یا دکمه</div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button class="btn secondary" id="openStagesBtn">انتخاب مرحله</button>
            <button class="btn secondary" id="resetBtn">ریست ذخیره</button>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- joystick -->
<div class="joystick-wrap" id="joystickWrap" aria-hidden="false">
  <div class="joy-base" id="joyBase">
    <div class="joy-knob" id="joyKnob" role="slider" aria-label="جوی‌استیک حرکت"></div>
  </div>
</div>

<!-- Stages modal -->
<div id="stageModal" style="position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;padding:18px;z-index:60">
  <div style="background:linear-gradient(180deg,#0b0b0d,#0f0f11);padding:14px;border-radius:10px;max-width:720px;width:100%;border:1px solid rgba(255,255,255,0.03)">
    <h3 style="margin:0 0 8px 0">انتخاب مرحله</h3>
    <div id="stagesGrid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px;max-height:60vh;overflow:auto;padding:6px"></div>
    <div style="text-align:center;margin-top:8px"><button class="btn secondary" id="closeStageModal">بستن</button></div>
  </div>
</div>

<!-- Lootbox Modal -->
<div id="lootboxModal" style="display:none;position:fixed;inset:0;z-index:100;align-items:center;justify-content:center;background:rgba(0,0,0,0.58)">
  <div style="background:linear-gradient(180deg,#0b0b0d,#101012);padding:22px 18px 18px 18px;border-radius:14px;max-width:340px;width:96%;text-align:center;border:1px solid rgba(255,255,255,0.04)">
    <h2 style="margin:0 0 16px 0;font-size:1.1rem;color:var(--accent)">صندوق جایزه!</h2>
    <div id="lootboxContent" style="margin-bottom:14px"></div>
    <button class="btn" id="openLootboxBtn">باز کردن صندوق</button>
  </div>
</div>

<footer style="width:100%;max-width:1100px;margin-top:12px;text-align:center;color:#cfd8dc">
  <div>نسخه آزمایشی — Cooldown + Joystick</div>
  <div class="made-by">ساخته شده توسط Rob Lucci</div>
</footer>

<script src="game.js"></script>
</body>
            </html>
