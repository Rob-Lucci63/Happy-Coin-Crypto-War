<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Boss Fight</title>
<style>
body {
    font-family: sans-serif;
    background: #111;
    color: white;
    text-align: center;
    margin: 0;
}
button {
    padding: 10px 20px;
    margin: 10px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}
#stageModal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 100;
    justify-content: center;
    align-items: center;
}
#stageList {
    width: 80%;
    max-height: 70%;
    overflow-y: auto;
    background: #222;
    border-radius: 10px;
    padding: 20px;
}
.stage-btn {
    display: inline-block;
    background: #444;
    color: white;
    margin: 5px;
    padding: 10px;
    border-radius: 6px;
}
.stage-btn:disabled {
    background: gray;
    cursor: not-allowed;
}
#exitBtn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: red;
    color: white;
    font-size: 20px;
    border-radius: 50px;
    padding: 12px 18px;
    z-index: 200;
}
#hud {
    margin-top: 20px;
}
.hp-bar {
    height: 20px;
    width: 300px;
    background: gray;
    border-radius: 10px;
    margin: auto;
    overflow: hidden;
}
.hp-fill {
    height: 100%;
    background: green;
}
</style>
</head>
<body>

<h1>نبرد باس</h1>
<div id="hud">
    <p>سکه‌ها: <span id="coins">0</span></p>
    <p>دیتا سنتر: <span id="dcCount">0</span></p>
</div>
<div>
    <p>جون شما</p>
    <div class="hp-bar"><div id="playerHPBar" class="hp-fill"></div></div>
    <p>جون باس</p>
    <div class="hp-bar"><div id="bossHPBar" class="hp-fill"></div></div>
</div>
<button onclick="openStages()">انتخاب مرحله</button>
<button onclick="buyDataCenter()">خرید دیتا سنتر</button>
<button onclick="attack()">حمله</button>

<div id="stageModal">
    <div id="stageList"></div>
    <button id="exitBtn" onclick="closeStages()">خروج</button>
</div>

<p id="credit" style="margin-top:40px;">ساخته شده توسط Rob Lucci</p>

<script>
let coins = parseInt(localStorage.getItem('coins')) || 0;
let dcCount = parseInt(localStorage.getItem('dcCount')) || 0;
let unlockedStage = parseInt(localStorage.getItem('unlockedStage')) || 1;
let currentStage = 1;
let playerMaxHP = 100;
let playerHP = playerMaxHP;
let bossMaxHP = 100;
let bossHP = bossMaxHP;

updateHUD();
generateStages();

function updateHUD(){
    document.getElementById('coins').textContent = coins;
    document.getElementById('dcCount').textContent = dcCount;
    document.getElementById('playerHPBar').style.width = (playerHP / playerMaxHP * 100) + '%';
    document.getElementById('bossHPBar').style.width = (bossHP / bossMaxHP * 100) + '%';
}

function generateStages(){
    const list = document.getElementById('stageList');
    list.innerHTML = '';
    for(let i=1; i<=34; i++){
        const btn = document.createElement('button');
        btn.textContent = 'مرحله ' + i;
        btn.className = 'stage-btn';
        if(i > unlockedStage) btn.disabled = true;
        btn.onclick = () => { selectStage(i); };
        list.appendChild(btn);
    }
}

function openStages(){
    document.getElementById('stageModal').style.display = 'flex';
}

function closeStages(){
    document.getElementById('stageModal').style.display = 'none';
}

function selectStage(stage){
    currentStage = stage;
    bossMaxHP = 100 + (stage - 1) * 50;
    bossHP = bossMaxHP;
    playerHP = playerMaxHP;
    updateHUD();
    closeStages();
}

function buyDataCenter(){
    if(coins >= 50){
        coins -= 50;
        dcCount++;
        playerMaxHP += 20; // افزایش جون
        localStorage.setItem('coins', coins);
        localStorage.setItem('dcCount', dcCount);
        updateHUD();
    } else {
        alert("سکه کافی نداری!");
    }
}

function attack(){
    let damage = 10 + dcCount * 5;
    bossHP -= damage;
    if(bossHP <= 0){
        coins += 20;
        if(currentStage === unlockedStage && unlockedStage < 34){
            unlockedStage++;
            localStorage.setItem('unlockedStage', unlockedStage);
            generateStages();
        }
        localStorage.setItem('coins', coins);
        bossHP = bossMaxHP;
        playerHP = playerMaxHP; // پر کردن جون بعد از مرحله
        updateHUD();
        alert("مرحله " + currentStage + " رو بردی!");
    } else {
        let bossDamage = 15 + (currentStage - 1) * 2;
        playerHP -= bossDamage;
        if(playerHP <= 0){
            playerHP = 0;
            updateHUD();
            alert("باختی! دوباره تلاش کن");
            playerHP = playerMaxHP;
            bossHP = bossMaxHP;
        }
    }
    updateHUD();
}
</script>
</body>
</html>